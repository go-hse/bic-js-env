<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>JavaScript Trainer</title>
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png" sizes="180x180" type="image/png">
    <link rel="icon" href="img/icon-48x48.png" sizes="48x48" type="image/png">
    <link rel="icon" href="img/favicon.ico" sizes="any">
    <link rel="icon" type="image/x-icon" href="/src/html/img/favicon.ico">
    <link rel="icon" href="img/icon-16x16.png" sizes="16x16" type="image/png">

    <!-- CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/formulajs/formulajs@2.9.3/dist/formula.min.js"></script>
<style type="text/css">/*!**************************************************************************!*\
  !*** css ./node_modules/css-loader/dist/cjs.js!./src/html/css/style.css ***!
  \**************************************************************************/
/* Layout */

html,
body {
    height: 100%;
    margin: 0;
    padding: 0;
    height: 100vh;
    background-color: #f0f0f0;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

h1,
h2,
h3,
h4 {
    margin: 0;
}

.container {
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    height: 100vh;
    width: 100vw;
}

.column {
    display: flex;
    flex-direction: column;
    background-color: #aaa;
}

.row {
    display: flex;
    flex: 20;
    flex-direction: row;
}

.hidden {
    display: none;
}

.flex1 {
    flex: 1;
}

.flex2 {
    flex: 2;
}

.flex3 {
    flex: 3;
}

.flex5 {
    flex: 5;
}


.flex8 {
    flex: 8;
}

.flex-large {
    display: flex;
    flex: 20;
}

/* Interactive Objects */

#overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(240, 240, 240, 0.8);
    color: #333;
    display: none;
    justify-content: center;
    align-items: center;
    font-size: 1.5em;
    border: 3px dashed #aaa;
    z-index: 9999;
}

.CodeMirror {
    height: 100% !important;
    width: 100% !important;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-x: hidden;
}

select {
    height: 100%;
    width: 100%;
    position: relative;
}

.select-input {
    position: absolute;
    display: none;
    font-size: 12px;
    z-index: 1000;
    border: 1px solid #aaa;
    margin: 0;
    padding: 0;
}

#output {
    background: #f5f5f5;
    padding: 10px;
    height: 150px;
    overflow-y: auto;
    font-family: monospace;
    white-space: pre-wrap;
    border: 1px solid #ccc;
}

button {
    margin: 4px;
    padding: 2px;
    background-color: #007BFF;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    width: 80px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.info {
    font-size: 12px;
}

button.green {
    background-color: #7fbd14;
}

button.green:hover {
    background-color: #619010;
}

button.red {
    background-color: #bd1414;
}

button.red:hover {
    background-color: #8f1212;
}


button:hover {
    background-color: #0056b3;
    /* Dunkleres Blau bei Hover */
    transform: translateY(-1px);
    /* Kleiner "Lift"-Effekt */
}

button:active {
    transform: translateY(0);
    /* Zur√ºck beim Klicken */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

iframe {
    display: none;
}


/* Windows */

.window {
    width: 300px;
    height: 200px;
    background-color: #fff;
    border: 1px solid #ccc;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    position: absolute;
    top: 50px;
    left: 50px;
    display: flex;
    flex-direction: column;
    border-radius: 6px;
    overflow: hidden;
}

.title-bar {
    background-color: #2c3e50;
    color: white;
    padding: 10px;
    cursor: move;
    user-select: none;
}

.content {
    padding: 10px;
    flex: 1;
    background-color: #fdfdfd;
    overflow: auto;
}

.resizer {
    width: 16px;
    height: 16px;
    background: transparent;
    border-right: 2px solid #888;
    border-bottom: 2px solid #888;
    position: absolute;
    right: 0;
    bottom: 0;
    cursor: se-resize;
}
</style></head>

<body>
<script defer>/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/html/css/style.css":
/*!********************************!*\
  !*** ./src/html/css/style.css ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack://bic-js-env/./src/html/css/style.css?\n}");

/***/ }),

/***/ "./src/html/index.js":
/*!***************************!*\
  !*** ./src/html/index.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _css_style_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./css/style.css */ \"./src/html/css/style.css\");\n/* harmony import */ var _js_client_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./js/client.mjs */ \"./src/html/js/client.mjs\");\n/* harmony import */ var _js_iframe_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./js/iframe.mjs */ \"./src/html/js/iframe.mjs\");\n\r\n\r\n\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    (0,_js_iframe_mjs__WEBPACK_IMPORTED_MODULE_2__.iframe)();\r\n    (0,_js_client_mjs__WEBPACK_IMPORTED_MODULE_1__.Main)();\r\n});\r\n\n\n//# sourceURL=webpack://bic-js-env/./src/html/index.js?\n}");

/***/ }),

/***/ "./src/html/js/client.mjs":
/*!********************************!*\
  !*** ./src/html/js/client.mjs ***!
  \********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Main: () => (/* binding */ Main)\n/* harmony export */ });\n/* harmony import */ var _keyboard_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./keyboard.mjs */ \"./src/html/js/keyboard.mjs\");\n/* harmony import */ var _dateformat_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dateformat.mjs */ \"./src/html/js/dateformat.mjs\");\n/* harmony import */ var _dom_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./dom.mjs */ \"./src/html/js/dom.mjs\");\n\r\n\r\n\r\n\r\n\r\nconst default_script = `\r\n// Globals: x, name\r\nfor (let i = 0; i < 5; i++) {\r\n    x += i;\r\n    console.log('x is', x);\r\n}\r\n\r\nlet test_name = \"test\";\r\ntry {\r\n    test_name = name;\r\n} catch (ex) {\r\n    console.log(ex.message);\r\n}\r\n\r\nconst output = {\r\n    x,\r\n    d: new Date().toString(),\r\n    test_name\r\n}\r\noutput;\r\n`;\r\n\r\nconst default_json = `\r\n{\r\n    \"x\": 5, \r\n    \"name\": \"Anna\"\r\n}\r\n`;\r\n\r\nasync function Main() {\r\n    const addKey = (0,_keyboard_mjs__WEBPACK_IMPORTED_MODULE_0__.keyboard)();\r\n\r\n    const windowManager = (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.Windows)();\r\n    const editorWindow = windowManager.create(\"editor\", document.body, { x: 0, y: 0, w: 400, h: 600 });\r\n    const jsonWindow = windowManager.create(\"json\", document.body, { x: 401, y: 0, w: 400, h: 600 });\r\n    const outputWindow = windowManager.create(\"output\", document.body, { x: 802, y: 100, w: 200, h: 600 });\r\n    const interfaceWindow = windowManager.create(\"ui\", document.body, { x: 802, y: 0, w: 200, h: 600 });\r\n\r\n\r\n    const codeEditor = CodeMirror(editorWindow.contentElement, {\r\n        value: default_script,\r\n        mode: \"javascript\",\r\n        lineNumbers: true\r\n    });\r\n\r\n    const jsonEditor = CodeMirror(jsonWindow.contentElement, {\r\n        value: default_json,\r\n        mode: \"application/json\",\r\n        lineNumbers: true,\r\n        lineWrapping: true\r\n    });\r\n\r\n    const output = outputWindow.contentElement;\r\n\r\n    const editInput = (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.dom)(\"input\", { type: \"text\", class: \"select-input\" });\r\n    const selectBox = (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.dom)(\"select\", { size: \"5\" });\r\n\r\n    interfaceWindow.contentElement.appendChild(selectBox);\r\n    interfaceWindow.contentElement.appendChild(editInput);\r\n\r\n    document.addEventListener('click', function (e) {\r\n        if (e.target !== editInput && e.target !== selectBox) {\r\n            editInput.style.display = \"none\";\r\n        }\r\n    });\r\n\r\n    let currentSelectedValue;\r\n    selectBox.addEventListener('change', function () {\r\n        const selected = selectBox.value;\r\n        output.textContent += `Selected: ${selected} \\n`;\r\n        saveToLocalStorage();\r\n        setCode(selected);\r\n        currentSelectedValue = selected;\r\n    });\r\n\r\n    const titleRectHeight = interfaceWindow.titleElement.getBoundingClientRect().height;\r\n\r\n\r\n    function startEditingOption(optionIndex) {\r\n        const option = selectBox.options[optionIndex];\r\n        const optRect = option.getBoundingClientRect();\r\n\r\n        if (!option) return;\r\n        const oldValue = option.value;\r\n\r\n        const rect = selectBox.getBoundingClientRect();\r\n        const top = titleRectHeight + 5 + optRect.height * optionIndex; // rect.top + \r\n\r\n        console.log(`i ${optionIndex} rh ${rect.height} oh ${optRect.height}`);\r\n\r\n        editInput.style.left = \"0px\";\r\n        editInput.style.top = top + \"px\";\r\n        editInput.style.width = (rect.width - 20) + \"px\";\r\n        editInput.style.height = \"14px\";\r\n        editInput.value = option.text;\r\n        editInput.style.display = \"block\";\r\n        editInput.focus();\r\n\r\n        // Event-Handler f√ºr Eingabe\r\n        editInput.onkeydown = function (e) {\r\n            if (e.key === \"Enter\") {\r\n                option.text = editInput.value;\r\n                option.value = editInput.value;\r\n                editInput.style.display = \"none\";\r\n                codemap[option.value] = codemap[oldValue];\r\n                delete codemap[oldValue];\r\n                localStorage.setItem(\"codemap\", JSON.stringify(codemap));\r\n            } else if (e.key === \"Escape\") {\r\n                editInput.style.display = \"none\";\r\n            }\r\n        };\r\n    }\r\n\r\n    function saveToLocalStorage() {\r\n        if (currentSelectedValue) {\r\n            const globals = jsonEditor.getValue();\r\n            const code = codeEditor.getValue();\r\n            codemap[currentSelectedValue] = { globals, code };\r\n            localStorage.setItem(\"codemap\", JSON.stringify(codemap));\r\n            output.textContent += `Saved to ${currentSelectedValue} \\n`;\r\n        }\r\n    }\r\n\r\n    // Doppelklick auf Select ‚Üí Bearbeiten starten\r\n    selectBox.addEventListener('dblclick', function () {\r\n        const index = selectBox.selectedIndex;\r\n        if (index !== -1) {\r\n            startEditingOption(index);\r\n        }\r\n    });\r\n\r\n    function setCode(key) {\r\n        if (codemap[key] !== undefined) {\r\n            const { globals, code } = codemap[key];\r\n            jsonEditor.setValue(globals);\r\n            codeEditor.setValue(code);\r\n        }\r\n    }\r\n\r\n    function addOption(key) {\r\n        const option = document.createElement('option');\r\n        option.text = key;\r\n        option.value = key;\r\n        selectBox.appendChild(option);\r\n    }\r\n\r\n    const codestring = localStorage.getItem(\"codemap\") || \"{}\";\r\n    const codemap = JSON.parse(codestring);\r\n    const keys = Object.keys(codemap);\r\n    for (const key of keys) {\r\n        addOption(key);\r\n    }\r\n\r\n    (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.Button)(\"Save\", interfaceWindow.contentElement, saveToLocalStorage, \"Saves all entries (code+json) to local storage in your browser\");\r\n    (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.Button)(\"New\", interfaceWindow.contentElement, () => {\r\n        const globals = jsonEditor.getValue();\r\n        const code = codeEditor.getValue();\r\n\r\n        const now = new Date();\r\n        const formatted = now.toLocaleString(); // z.‚ÄØB. \"16.7.2025, 14:23:45\"\r\n        const option = document.createElement('option');\r\n\r\n        addOption(formatted);\r\n        codemap[formatted] = { globals, code };\r\n        localStorage.setItem(\"codemap\", JSON.stringify(codemap));\r\n        output.textContent += `Created: ${formatted} \\n`;\r\n\r\n    }, \"Creates a new entry (name: current date) with the actual code+json.\");\r\n\r\n\r\n    (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.Button)(\"Delete\", interfaceWindow.contentElement, () => {\r\n        const selectedIndex = selectBox.selectedIndex;\r\n        const key = selectBox.value;\r\n        if (selectedIndex !== -1) {\r\n            selectBox.remove(selectedIndex);\r\n            output.textContent += `Deleted: ${key} \\n`;\r\n            if (codemap[key] !== undefined) {\r\n                delete codemap[key];\r\n                const codemapString = JSON.stringify(codemap);\r\n                localStorage.setItem(\"codemap\", codemapString);\r\n            }\r\n        }\r\n    }, \"Deletes current item (code+json)\");\r\n\r\n    addKey(\"F1\", runCode);\r\n\r\n    (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.Button)(\"Run (F1)\", interfaceWindow.contentElement, runCode, \"Runs the code with json-data\");\r\n    (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.Button)(\"Download\", interfaceWindow.contentElement, downloadJSON, \"Downloads all items (code+json) together in a single json-file. You can upload that file by dragging it in here.\");\r\n\r\n    function downloadJSON() {\r\n        const jsonString = JSON.stringify(codemap, null, 2);\r\n        const blob = new Blob([jsonString], { type: \"application/json\" });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement(\"a\");\r\n        a.href = url;\r\n        const datestring = (0,_dateformat_mjs__WEBPACK_IMPORTED_MODULE_1__.dateFormat)(new Date(), _dateformat_mjs__WEBPACK_IMPORTED_MODULE_1__.ymdhmsFileFormatter);\r\n        a.download = `bic-code-data.${datestring}.json`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n        URL.revokeObjectURL(url);\r\n    }\r\n\r\n    function runCode() {\r\n        let globals = {};\r\n        try {\r\n            const globalsRaw = jsonEditor.getValue();\r\n            globals = globalsRaw ? JSON.parse(globalsRaw) : {};\r\n        } catch (e) {\r\n            output.textContent = \"Global variable parsing error: \" + e.message;\r\n            return;\r\n        }\r\n        output.textContent = \"\";\r\n        const code = codeEditor.getValue();\r\n        const iframe = document.getElementById(\"sandbox\");\r\n        iframe.contentWindow.postMessage({ code, globals }, \"*\");\r\n    };\r\n\r\n    const overlay = (0,_dom_mjs__WEBPACK_IMPORTED_MODULE_2__.dom)(\"div\");\r\n    document.body.appendChild(overlay);\r\n\r\n    ['dragenter', 'dragover'].forEach(eventName => {\r\n        document.addEventListener(eventName, (e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            overlay.style.display = 'flex';\r\n        }, false);\r\n    });\r\n\r\n    ['dragleave', 'drop'].forEach(eventName => {\r\n        document.addEventListener(eventName, (e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            overlay.style.display = 'none';\r\n        }, false);\r\n    });\r\n\r\n\r\n    function codesFromJSON(json) {\r\n        const newkeys = Object.keys(json);\r\n        for (const key of newkeys) {\r\n            const newobj = json[key];\r\n            if (typeof newobj.code === \"string\" && typeof newobj.globals === \"string\") {\r\n                if (codemap[key] === undefined) {\r\n                    addOption(key);\r\n                }\r\n                codemap[key] = newobj;\r\n                console.log(\"added\", key, newobj)\r\n            }\r\n        }\r\n    }\r\n\r\n    // Datei verarbeiten beim Drop\r\n    document.addEventListener('drop', (e) => {\r\n        const files = e.dataTransfer.files;\r\n        if (files.length === 0) return;\r\n\r\n        const file = files[0];\r\n        if (!file.name.endsWith('.json')) {\r\n            output.textContent += 'Bitte eine JSON-Datei verwenden.';\r\n            return;\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = function (event) {\r\n            try {\r\n                const json = JSON.parse(event.target.result);\r\n                codesFromJSON(json);\r\n            } catch (err) {\r\n                output.textContent += 'Fehler beim Lesen der Datei:\\n' + err.message;\r\n            }\r\n            localStorage.setItem(\"codemap\", JSON.stringify(codemap));\r\n\r\n        };\r\n        reader.readAsText(file);\r\n    });\r\n\r\n    window.addEventListener(\"message\", (event) => {\r\n        if (event.data.type === \"log\") {\r\n            output.textContent += \"log:\" + event.data.data + \"\\n\";\r\n        }\r\n        if (event.data.type === \"error\") {\r\n            output.textContent += \"Error: \" + event.data.data + \"\\n\";\r\n        }\r\n        if (event.data.type === \"result\") {\r\n            output.textContent += \"output: \" + event.data.data + \"\\n\";\r\n        }\r\n    });\r\n\r\n\r\n    const observer = new MutationObserver(() => {\r\n        output.scrollTop = output.scrollHeight;\r\n    });\r\n\r\n    observer.observe(output, {\r\n        characterData: true,\r\n        childList: true,\r\n        subtree: true\r\n    });\r\n\r\n    try {\r\n        const response = await fetch('/dist/default_codes.json');\r\n        const default_codes = await response.json();\r\n        codesFromJSON(default_codes);\r\n    } catch (ex) {\r\n        console.log(ex);\r\n    }\r\n\r\n}\r\n\r\n\n\n//# sourceURL=webpack://bic-js-env/./src/html/js/client.mjs?\n}");

/***/ }),

/***/ "./src/html/js/dateformat.mjs":
/*!************************************!*\
  !*** ./src/html/js/dateformat.mjs ***!
  \************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dateFormat: () => (/* binding */ dateFormat),\n/* harmony export */   dmyFormatter: () => (/* binding */ dmyFormatter),\n/* harmony export */   dmyhmFormatter: () => (/* binding */ dmyhmFormatter),\n/* harmony export */   hmFormatter: () => (/* binding */ hmFormatter),\n/* harmony export */   hmsFormatter: () => (/* binding */ hmsFormatter),\n/* harmony export */   wdmyFormatter: () => (/* binding */ wdmyFormatter),\n/* harmony export */   ymdFormatter: () => (/* binding */ ymdFormatter),\n/* harmony export */   ymdhmsFileFormatter: () => (/* binding */ ymdhmsFileFormatter),\n/* harmony export */   ymdhmsFormatter: () => (/* binding */ ymdhmsFormatter)\n/* harmony export */ });\nconst ymdhmsFormatter = (yyyy, mm, dd, hh, mi, sc) => `${yyyy}-${mm}-${dd} ${hh}:${mi}:${sc}`;\r\nconst ymdhmsFileFormatter = (yyyy, mm, dd, hh, mi, sc) => `${yyyy}.${mm}.${dd}_${hh}.${mi}.${sc}`;\r\nconst dmyFormatter = (yyyy, mm, dd) => `${dd}.${mm}.${yyyy}`;\r\nconst wdmyFormatter = (yyyy, mm, dd, hh, mi, sc, wd) => `${wd}, ${dd}.${mm}.${yyyy}`;\r\nconst dmyhmFormatter = (yyyy, mm, dd, hh, mi) => `${dd}.${mm}.${yyyy} ${hh}:${mi}`;\r\nconst ymdFormatter = (yyyy, mm, dd) => `${yyyy}.${mm}.${dd}`;\r\nconst hmFormatter = (yyyy, mm, dd, hh, mi) => `${hh}:${mi}`;\r\nconst hmsFormatter = (yyyy, mm, dd, hh, mi, sc) => `${hh}:${mi}:${sc}`;\r\n\r\nconst WD = [\"So.\", \"Mo.\", \"Di.\", \"Mi.\", \"Do.\", \"Fr.\", \"Sa.\"];\r\n\r\nfunction dateFormat(d = new Date(), formatter = ymdhmsFormatter) {\r\n    const yyyy = d.getFullYear().toString();\r\n    const mm = (d.getMonth() + 1).toString().padStart(2, \"0\");\r\n    const dd = d.getDate().toString().padStart(2, \"0\");\r\n    const hh = d.getHours().toString().padStart(2, \"0\");\r\n    const mi = d.getMinutes().toString().padStart(2, \"0\");\r\n    const sc = d.getSeconds().toString().padStart(2, \"0\");\r\n    const wd = d.getDay();\r\n    return formatter(yyyy, mm, dd, hh, mi, sc, WD[wd]);\r\n};\r\n\n\n//# sourceURL=webpack://bic-js-env/./src/html/js/dateformat.mjs?\n}");

/***/ }),

/***/ "./src/html/js/dom.mjs":
/*!*****************************!*\
  !*** ./src/html/js/dom.mjs ***!
  \*****************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Button: () => (/* binding */ Button),\n/* harmony export */   Windows: () => (/* binding */ Windows),\n/* harmony export */   checkBox: () => (/* binding */ checkBox),\n/* harmony export */   dom: () => (/* binding */ dom),\n/* harmony export */   removeAllChildren: () => (/* binding */ removeAllChildren)\n/* harmony export */ });\nfunction dom(tag, attributes = {}, ...children) {\r\n    const namespace = attributes.namespace || \"http://www.w3.org/1999/xhtml\";\r\n    const node = document.createElementNS(namespace, tag);\r\n\r\n    for (const [key, value] of Object.entries(attributes)) {\r\n        if (key === \"namespace\" || key === \"events\" || key === \"text\") continue;\r\n        if (value !== false && value != null) {\r\n            node.setAttribute(key, String(value));\r\n        }\r\n    }\r\n\r\n    if (attributes.events && typeof attributes.events === \"object\") {\r\n        for (const [event, handler] of Object.entries(attributes.events)) {\r\n            if (typeof handler === \"function\") {\r\n                node.addEventListener(event, handler);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (typeof attributes.text === \"string\") {\r\n        node.appendChild(document.createTextNode(attributes.text));\r\n    }\r\n\r\n    for (const child of children) {\r\n        if (typeof child === \"string\") {\r\n            node.appendChild(document.createTextNode(child));\r\n        } else if (child instanceof Node) {\r\n            node.appendChild(child);\r\n        }\r\n    }\r\n\r\n    return node;\r\n}\r\n\r\nfunction Button(text, parent, callback, explanation = \"\") {\r\n    const span = dom(\"span\", { text: explanation });\r\n    const btn = dom(\"button\", { events: { click: callback } }, text);\r\n    const buttonElement = dom(\"div\", {}, btn, span);\r\n    parent.appendChild(buttonElement);\r\n}\r\n\r\n\r\nfunction removeAllChildren(ele) {\r\n    while (ele.firstChild) {\r\n        ele.removeChild(ele.lastChild);\r\n    }\r\n}\r\n\r\nfunction checkBox(parent, id, label) {\r\n    const checkBoxElement = dom(\"input\", { type: \"checkbox\", id });\r\n    const labelElement = dom(\"label\", { class: \"checkbox-label\", text: label });\r\n    labelElement.appendChild(checkBoxElement);\r\n    parent.appendChild(labelElement);\r\n\r\n    const item = localStorage.getItem(id);\r\n    checkBoxElement.checked = item !== null && item === \"true\";\r\n    console.log(id, checkBoxElement.checked);\r\n\r\n    checkBoxElement.addEventListener(\"change\", () => {\r\n        localStorage.setItem(id, checkBoxElement.checked);\r\n        console.log(\"checkBox\", id, checkBoxElement.checked);\r\n    });\r\n}\r\n\r\n\r\n///////////////////////////////////////////////////////////////////////////\r\n// WINDOW-Handling\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\n\r\nfunction Windows() {\r\n    const windows = {};\r\n    let currentWindowId, zIndex = 0;\r\n\r\n    function bringToFront(el) {\r\n        el.style.zIndex = ++zIndex;\r\n        currentWindowId = el.id;\r\n    }\r\n\r\n    function setPos(id, x, y) {\r\n        if (windows[id]) {\r\n            windows[id].options.x = x;\r\n            windows[id].options.y = y;\r\n            saveToLocalStorage(id);\r\n        }\r\n    }\r\n\r\n    function setSize(id, w, h) {\r\n        if (windows[id]) {\r\n            windows[id].options.w = w;\r\n            windows[id].options.h = h;\r\n            saveToLocalStorage(id);\r\n        }\r\n    }\r\n\r\n    function makeDraggable(windowElement) {\r\n        const id = windowElement.id;\r\n        const windowObj = windows[id];\r\n        let isDragging, newX, newY;\r\n\r\n        let offsetX = 0, offsetY = 0;\r\n        windowObj.titleElement.addEventListener('mousedown', function (e) {\r\n            isDragging = id;\r\n            offsetX = e.clientX - windowElement.offsetLeft;\r\n            offsetY = e.clientY - windowElement.offsetTop;\r\n            document.body.style.userSelect = 'none';\r\n            bringToFront(windowElement);\r\n        });\r\n\r\n        document.addEventListener('mousemove', function (e) {\r\n            if (isDragging === id) {\r\n                newX = e.clientX - offsetX;\r\n                newY = e.clientY - offsetY;\r\n\r\n                const maxX = window.innerWidth - windowElement.offsetWidth;\r\n                const maxY = window.innerHeight - windowElement.offsetHeight;\r\n\r\n                newX = Math.max(0, Math.min(newX, maxX));\r\n                newY = Math.max(0, Math.min(newY, maxY));\r\n\r\n                windowElement.style.left = newX + 'px';\r\n                windowElement.style.top = newY + 'px';\r\n                console.log(\"move\", id, newX, newY);\r\n\r\n            }\r\n        });\r\n\r\n        document.addEventListener('mouseup', function () {\r\n            if (isDragging === id) {\r\n                isDragging = undefined;\r\n                document.body.style.userSelect = '';\r\n                setPos(id, newX, newY);\r\n                console.log(\"mouseup isDragging\", id);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    function makeResizable(windowElement) {\r\n        const id = windowElement.id;\r\n        const resizer = windowElement.querySelector('.resizer');\r\n        let minWidth = 200;\r\n        let minHeight = 100;\r\n        let isResizing, newWidth, newHeight;\r\n\r\n\r\n        resizer.addEventListener('mousedown', function (e) {\r\n            isResizing = id;\r\n            bringToFront(windowElement);\r\n            document.body.style.userSelect = 'none';\r\n            e.preventDefault();\r\n        });\r\n\r\n        document.addEventListener('mousemove', function (e) {\r\n            if (isResizing === id) {\r\n                newWidth = e.clientX - windowElement.offsetLeft;\r\n                newHeight = e.clientY - windowElement.offsetTop;\r\n\r\n                newWidth = Math.max(minWidth, Math.min(newWidth, window.innerWidth - windowElement.offsetLeft));\r\n                newHeight = Math.max(minHeight, Math.min(newHeight, window.innerHeight - windowElement.offsetTop));\r\n\r\n                windowElement.style.width = newWidth + 'px';\r\n                windowElement.style.height = newHeight + 'px';\r\n                console.log(\"resize\", id, newWidth, newHeight);\r\n            }\r\n        });\r\n\r\n        document.addEventListener('mouseup', function () {\r\n            console.log(\"mouseup isResizing\", id, isResizing);\r\n            if (isResizing === id) {\r\n                isResizing = undefined;\r\n                document.body.style.userSelect = '';\r\n                setSize(id, newWidth, newHeight);\r\n                console.log(\"finished isResizing\", id);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    function setPosSize(windowElement, x, y, newWidth, newHeight) {\r\n        windowElement.style.left = x + 'px';\r\n        windowElement.style.top = y + 'px';\r\n        windowElement.style.width = newWidth + 'px';\r\n        windowElement.style.height = newHeight + 'px';\r\n    }\r\n\r\n    ///////////////////////////////////////////////////////////////////////////\r\n    // INTERFACE\r\n    ///////////////////////////////////////////////////////////////////////////\r\n\r\n    function create(id, parent, options) {\r\n        options.title ??= `Title: ${id}`;\r\n        const titleElement = dom(\"div\", { class: \"title-bar\", id: `title_${id}`, text: options.title });\r\n        const contentElement = dom(\"div\", { id: `content_${id}` });\r\n        const resizeElement = dom(\"div\", { class: \"resizer\", id: `content_${id}` });\r\n\r\n        const windowElement = dom(\"div\", { class: \"window\", id }, titleElement, contentElement, resizeElement);\r\n        parent.appendChild(windowElement);\r\n        windowElement.style.zIndex = ++zIndex;\r\n\r\n\r\n        currentWindowId = id;\r\n        windows[id] = { windowElement, titleElement, contentElement, resizeElement, options };\r\n\r\n        makeDraggable(windowElement);\r\n        makeResizable(windowElement);\r\n\r\n        if (options && typeof options.x === \"number\" && typeof options.y === \"number\" && typeof options.w === \"number\" && typeof options.h === \"number\") {\r\n            setPosSize(windowElement, options.x, options.y, options.w, options.h);\r\n        }\r\n\r\n        retrieveFromLocalStorage(id);\r\n        return windows[id];\r\n    }\r\n\r\n    function setTitle(id, title) {\r\n        if (windows[id]) {\r\n            windows[id].titleElement.textContent = title;\r\n            windows[id].options.title = title;\r\n        }\r\n    }\r\n\r\n    function saveToLocalStorage(id) {\r\n        if (windows[id]) {\r\n            console.log(\"saving\", id, windows[id].options);\r\n            localStorage.setItem(`window.${id}`, JSON.stringify(windows[id].options));\r\n        }\r\n    }\r\n\r\n    function retrieveFromLocalStorage(id) {\r\n        const item = localStorage.getItem(`window.${id}`);\r\n        if (item && windows[id]) {\r\n            const options = JSON.parse(item);\r\n            console.log(\"retrieve\", id, windows[id].options);\r\n            const windowElement = windows[id].windowElement;\r\n            setPosSize(windowElement, options.x, options.y, options.w, options.h);\r\n            windows[id].options = options;\r\n        }\r\n    }\r\n\r\n\r\n    function get(id) {\r\n        return windows[id];\r\n    }\r\n\r\n    return { create, get, setTitle };\r\n}\r\n\r\n\r\n\r\n\r\n\n\n//# sourceURL=webpack://bic-js-env/./src/html/js/dom.mjs?\n}");

/***/ }),

/***/ "./src/html/js/iframe.mjs":
/*!********************************!*\
  !*** ./src/html/js/iframe.mjs ***!
  \********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   iframe: () => (/* binding */ iframe)\n/* harmony export */ });\n\r\nfunction iframe() {\r\n    const iframeEle = document.createElement(`iframe`);\r\n    iframeEle.setAttribute(\"id\", \"sandbox\");\r\n    iframeEle.setAttribute(\"sandbox\", \"allow-same-origin allow-scripts allow-popups allow-forms\");\r\n    iframeEle.onload = function (ele) {\r\n\r\n        function evalInScope(code, contextAsScope) {\r\n            console.log(\"call\", code, contextAsScope);\r\n            return new Function(`with (this) { return eval(${JSON.stringify(code)}); }`).call(contextAsScope);\r\n        }\r\n\r\n        const console = {\r\n            log: (...args) => window.parent.postMessage({ type: 'log', data: args.join(' ') }, '*'),\r\n            error: (...args) => window.parent.postMessage({ type: 'error', data: args.join(' ') }, '*')\r\n        };\r\n\r\n        console.log(`myframe is loaded`, ele);\r\n\r\n        const context = { console };\r\n        Object.assign(context, formulajs);\r\n\r\n        evalInScope(`for(let i=0; i<3; ++i) console.log(i);`, context);\r\n\r\n        ele.target.contentWindow.addEventListener('message', function (event) {\r\n\r\n            const { code, globals } = event.data;\r\n            if (typeof globals === 'object' && globals !== null) {\r\n                Object.assign(context, globals);\r\n            }\r\n\r\n            try {\r\n                const result = evalInScope(code, context);\r\n\r\n                if (result !== undefined) {\r\n                    let output;\r\n                    if (typeof result === 'object' && result !== null) {\r\n                        try {\r\n                            output = JSON.stringify(result, null, 2);\r\n                        } catch (e) {\r\n                            output = '[object with circular reference]';\r\n                        }\r\n                    } else {\r\n                        output = String(result);\r\n                    }\r\n                    window.parent.postMessage({ type: 'result', data: output }, '*');\r\n                }\r\n            } catch (e) {\r\n                window.parent.postMessage({ type: 'error', data: e.message }, '*');\r\n            }\r\n        });\r\n\r\n\r\n\r\n    };\r\n    document.body.appendChild(iframeEle);\r\n}\n\n//# sourceURL=webpack://bic-js-env/./src/html/js/iframe.mjs?\n}");

/***/ }),

/***/ "./src/html/js/keyboard.mjs":
/*!**********************************!*\
  !*** ./src/html/js/keyboard.mjs ***!
  \**********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   keyboard: () => (/* binding */ keyboard)\n/* harmony export */ });\nfunction keyboard() {\r\n    const keys = {};\r\n\r\n    // toggle wird bei keydown:active=true oder keyup:active=false aufgerufen\r\n    function toggle(ev, active) {\r\n        if (keys[ev.key] !== undefined) {\r\n            ev.preventDefault();\r\n            const KeyObject = keys[ev.key];\r\n            if (KeyObject.active !== active) {\r\n                KeyObject.active = active;\r\n                KeyObject.callback(active);\r\n            }\r\n\r\n            if (!active && KeyObject.cbOnRelease !== undefined) {\r\n                KeyObject.cbOnRelease();\r\n            }\r\n        } else {\r\n            console.log(`unbekannt <${ev.key}>`);\r\n        }\r\n    }\r\n\r\n    // Listener\r\n    document.addEventListener(\"keydown\", (ev) => toggle(ev, true));\r\n    document.addEventListener(\"keyup\", (ev) => toggle(ev, false));\r\n\r\n    function add(key, callback, cbOnRelease) {\r\n        keys[key] = { active: false, callback, cbOnRelease };  // KeyObject, oben\r\n    }\r\n\r\n    return add;\r\n}\r\n\r\n\n\n//# sourceURL=webpack://bic-js-env/./src/html/js/keyboard.mjs?\n}");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/html/index.js");
/******/ 	
/******/ })()
;</script></body>

</html>