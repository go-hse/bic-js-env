<!doctype html><html lang="en"><head><meta charset="UTF-8"><title>JavaScript Trainer</title><link rel="icon" href="img/icon-512x512.png" sizes="512x512" type="image/png"><link rel="icon" href="img/icon-192x192.png" sizes="192x192" type="image/png"><link rel="apple-touch-icon" href="img/apple-touch-icon.png" sizes="180x180" type="image/png"><link rel="icon" href="img/icon-48x48.png" sizes="48x48" type="image/png"><link rel="icon" href="img/favicon.ico" sizes="any"><link rel="icon" type="image/x-icon" href="/src/html/img/favicon.ico"><link rel="icon" href="img/icon-16x16.png" sizes="16x16" type="image/png"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script><script src="https://cdn.jsdelivr.net/gh/formulajs/formulajs@2.9.3/dist/formula.min.js"></script><link rel="stylesheet" href="css/style.css"></head><body><div id="overlay">Datei hier ablegen</div><div class="container"><div class="flex1"><h2>JavaScript Trainer for BIC PE</h2></div><div class="row"><div class="column flex2"><div class="column flex-large"><h3>Global Variables (JSON)</h3><div id="json" class="flex-large"></div></div></div><div class="column flex2"><div class="column flex-large"><h3>States</h3><div class="flex-large"><input id="editInput"> <select id="selectBox" size="5"></select></div><div class="flex2"><button id="btnCopyNew">New Copy</button> <button id="btnSave">Save</button> <button id="btnDel" class="red">Delete</button> <button id="btnCopyJS">Copy JS</button> <button id="btnDown">Download</button> <span class="info">Use Drag-and-Drop to Upload</span></div></div></div><div class="column flex3"><div class="column flex-large"><h3>JavaScript</h3><div id="editor" class="flex-large"></div></div><div class="flex1"><button id="btnRun" class="green">Run (F1)</button></div></div></div><div id="output"></div><iframe id="sandbox" sandbox="allow-scripts" src="box.html"></iframe><script type="module" src="js/client.mjs"/></div><script defer="defer">(()=>{"use strict";const e=(e,t,n,o,a,d)=>`${e}-${t}-${n} ${o}:${a}:${d}`,t=(e,t,n,o,a,d)=>`${e}.${t}.${n}_${o}.${a}.${d}`,n=["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."],o=function(){const e={};function t(t,n){if(void 0!==e[t.key]){t.preventDefault();const o=e[t.key];o.active!==n&&(o.active=n,o.callback(n)),n||void 0===o.cbOnRelease||o.cbOnRelease()}else console.log(`unbekannt <${t.key}>`)}return document.addEventListener("keydown",e=>t(e,!0)),document.addEventListener("keyup",e=>t(e,!1)),function(t,n,o){e[t]={active:!1,callback:n,cbOnRelease:o}}}();window.onload=()=>{const a=CodeMirror(document.getElementById("editor"),{value:"\n// Globals: x, name\nfor (let i = 0; i < 5; i++) {\n    x += i;\n    console.log('x is', x);\n}\n\nlet test_name = \"test\";\ntry {\n    test_name = name;\n} catch (ex) {\n    console.log(ex.message);\n}\n\nconst output = {\n    x,\n    d: new Date().toString(),\n    test_name\n}\noutput;\n",mode:"javascript",lineNumbers:!0}),d=CodeMirror(document.getElementById("json"),{value:'\n{\n    "x": 5, \n    "name": "Anna"\n}\n',mode:"application/json",lineNumbers:!0}),c=document.getElementById("output"),l=document.getElementById("editInput");document.addEventListener("click",function(e){e.target!==l&&e.target!==s&&(l.style.display="none")});const s=document.getElementById("selectBox");let i;function r(){if(i){const e=d.getValue(),t=a.getValue();m[i]={globals:e,code:t},localStorage.setItem("codemap",JSON.stringify(m)),c.textContent+=`Saved to ${i} \n`}}function u(e){const t=document.createElement("option");t.text=e,t.value=e,s.appendChild(t)}s.addEventListener("change",function(){const e=s.value;c.textContent+=`Selected: ${e} \n`,r(),function(e){if(void 0!==m[e]){const{globals:t,code:n}=m[e];d.setValue(t),a.setValue(n)}}(e),i=e}),s.addEventListener("dblclick",function(){const e=s.selectedIndex;-1!==e&&function(e){const t=s.options[e];if(!t)return;const n=t.value,o=s.getBoundingClientRect(),a=o.height/s.size;l.style.left=o.left+"px",l.style.top=o.top+a*e+"px",l.style.width=o.width+"px",l.style.height="14px",l.value=t.text,l.style.display="block",l.focus(),l.onkeydown=function(e){"Enter"===e.key?(t.text=l.value,t.value=l.value,l.style.display="none",m[t.value]=m[n],delete m[n],localStorage.setItem("codemap",JSON.stringify(m))):"Escape"===e.key&&(l.style.display="none")}}(e)});const g=localStorage.getItem("codemap")||"{}",m=JSON.parse(g),p=Object.keys(m);for(const e of p)u(e);function y(){let e={};try{const t=d.getValue();e=t?JSON.parse(t):{}}catch(e){return void(c.textContent="Global variable parsing error: "+e.message)}c.textContent="";const t=a.getValue();document.getElementById("sandbox").contentWindow.postMessage({code:t,globals:e},"*")}document.getElementById("btnSave").addEventListener("click",r),document.getElementById("btnCopyNew").addEventListener("click",()=>{const e=d.getValue(),t=a.getValue(),n=(new Date).toLocaleString();document.createElement("option"),u(n),m[n]={globals:e,code:t},localStorage.setItem("codemap",JSON.stringify(m)),c.textContent+=`Created: ${n} \n`}),document.getElementById("btnDel").addEventListener("click",()=>{const e=s.selectedIndex,t=s.value;if(-1!==e&&(s.remove(e),c.textContent+=`Deleted: ${t} \n`,void 0!==m[t])){delete m[t];const e=JSON.stringify(m);localStorage.setItem("codemap",e)}}),o("F1",y),document.getElementById("btnRun").addEventListener("click",y),document.getElementById("btnDown").addEventListener("click",function(){const o=JSON.stringify(m,null,2),a=new Blob([o],{type:"application/json"}),d=URL.createObjectURL(a),c=document.createElement("a");c.href=d;const l=function(t=new Date,o=e){const a=t.getFullYear().toString(),d=(t.getMonth()+1).toString().padStart(2,"0"),c=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0"),r=t.getDay();return o(a,d,c,l,s,i,n[r])}(new Date,t);c.download=`bic-code-data.${l}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(d)});const v=document.getElementById("overlay");["dragenter","dragover"].forEach(e=>{document.addEventListener(e,e=>{e.preventDefault(),e.stopPropagation(),v.style.display="flex"},!1)}),["dragleave","drop"].forEach(e=>{document.addEventListener(e,e=>{e.preventDefault(),e.stopPropagation(),v.style.display="none"},!1)}),document.addEventListener("drop",e=>{const t=e.dataTransfer.files;if(0===t.length)return;const n=t[0];if(!n.name.endsWith(".json"))return void(c.textContent+="Bitte eine JSON-Datei verwenden.");const o=new FileReader;o.onload=function(e){try{const t=JSON.parse(e.target.result),n=Object.keys(t);for(const e of n){const n=t[e];"string"==typeof n.code&&"string"==typeof n.globals&&(void 0===m[e]&&u(e),m[e]=n,console.log("added",e,n))}}catch(e){c.textContent+="Fehler beim Lesen der Datei:\n"+e.message}localStorage.setItem("codemap",JSON.stringify(m))},o.readAsText(n)}),window.addEventListener("message",e=>{"log"===e.data.type&&(c.textContent+="log:"+e.data.data+"\n"),"error"===e.data.type&&(c.textContent+="Error: "+e.data.data+"\n"),"result"===e.data.type&&(c.textContent+="output: "+e.data.data+"\n")}),new MutationObserver(()=>{c.scrollTop=c.scrollHeight}).observe(c,{characterData:!0,childList:!0,subtree:!0})}})();</script></body></html>